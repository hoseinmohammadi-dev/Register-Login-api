<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="style.Login.css">
</head>

<body>
    <div class="Login">
        <h1>Login</h1>
        <input class="email" type="email" placeholder="Your Email">
        <input class="password" type="password" placeholder="Your password">
        <button class="LogBtn">Login</button>
    </div>

    <!-- Profile Box -->
    <div class="Profile">
        <h2>Profile</h2>
        <P id="FullName"></P>
        <P id="Email"></P>
        <P id="Password"></P>
        <P id="Age"></P>
        <!-- buttons -->
        <button onclick="myEdit()">Edit</button>
        <button onclick="myDel()">Delete</button>
        <button onclick="myExit()">Exit</button>
        <!-- Edit Boc -->

        <div class="edit-box">
            <input type="text" placeholder="FullName">
            <input type="email" placeholder="Email">
            <input type="password" placeholder="password">
            <input type="number" placeholder="Age">
            <button>Register Changes</button>
        </div>
    </div>
    <!-- Profile Box -->
</body>
<script>
    const API = 'https://68c3f89d81ff90c8e61ac7b0.mockapi.io/Users'

    const LogBtn = document.querySelector('.LogBtn')
    const LoginBox = document.querySelector('.Login')
    const ProfileBox = document.querySelector('.Profile')
    const editBox = document.querySelector('.edit-box')
    const regChange = document.querySelector(".edit-box > button")

    let CurrentUser = null

    async function getAllUsers() {
        const res = await fetch(API)
        if (!res.ok) throw new Error("Error receiving users")
        return res.json()
    }


    LogBtn.addEventListener('click', async () => {

        const email = document.querySelector('.email').value.trim().toLowerCase()
        const pass = document.querySelector('.password').value

        if (email == '' || pass == '') {
            alert('fill your email and password')
            return
        }
        try {
            const users = await getAllUsers()

            const user = users.find(
                u => (u.Email || '').toLowerCase() === email && (u.Password || '') === pass
            );

            if (user) {
                CurrentUser = user

                alert('Login successful ✅')

                LoginBox.style.display = 'none'
                ProfileBox.style.display = 'flex'
                editBox.style.display = 'none'
                ShowData(user)

            } else {
                alert('wrong !!!!')
            }

        } catch (err) {
            console.error(err);

        }
    })

    function ShowData(user) {
        document.getElementById('FullName').textContent = 'FullName :' + user.FullName
        document.getElementById('Email').textContent = 'Email :' + user.Email
        document.getElementById('Password').textContent = 'Password :' + user.Password
        document.getElementById('Age').textContent = 'Age :' + user.Age
    }


    function myEdit() {
        editBox.style.display = 'block'
        document.querySelector('.edit-box input[type="text"]').value = CurrentUser.FullName
        document.querySelector('.edit-box input[type="email"]').value = CurrentUser.Email
        document.querySelector('.edit-box input[type="password"]').value = CurrentUser.Password
        document.querySelector('.edit-box input[type="number"]').value = CurrentUser.Age
    }

    regChange.addEventListener('click', async () => {
        const newFullName = document.querySelector('.edit-box input[type="text"]').value;
        const newEmail = document.querySelector('.edit-box input[type="email"]').value;
        const newPassword = document.querySelector('.edit-box input[type="password"]').value;
        const newAge = document.querySelector('.edit-box input[type="number"]').value;

        try {
            const res = await fetch(`${API}/${CurrentUser.id}`, {
                method: 'PUT',
                headers: { 'content-type': 'application/json' },
                body: JSON.stringify({
                    FullName: newFullName,
                    Email: newEmail,
                    Password: newPassword,
                    Age: newAge
                })
            });
            if (!res.ok) throw new Error("Error updating user");
            const updatedUser = await res.json();

            CurrentUser = updatedUser;
            ShowData(updatedUser);

            editBox.style.display = 'none';

            alert('User updated!');
        } catch (err) {
            console.error(err);
            alert('Failed to update user!');
        }
    })

    // Exit
    function myExit() {
        CurrentUser = null
        LoginBox.style.display = 'flex'
        ProfileBox.style.display = 'none'
        document.querySelector('.email').value = null;
        document.querySelector('.password').value = null
    }
    // Exit

    // mydel
    async function myDel() {
        if (!confirm("Do you want to clear your account")) return;

        try {
            await fetch(`${API}/${CurrentUser.id}`, { method: "DELETE" });
            alert("delete user❌");
            myExit();

        } catch (err) {
            console.error(err);
            alert("wrong❌");
        }


    }
    // mydel

</script>

</html>